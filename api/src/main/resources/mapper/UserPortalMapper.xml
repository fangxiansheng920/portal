<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.icheer.portal.mapper.UserPortalMapper">

    <!--通过用户id和站点id查询用户和站点的关系-->
    <select id="getUserPortal" resultType="UserPortal">
        select id, user_id, portal_id, last_use_at, permission
        from user_portals
        where user_id = #{userId}
          and portal_id = #{portalId}
    </select>

    <!--更新用户和站点的关系中last_use_at字段-->
    <update id="updateUserPortalLastUseAt">
        update user_portals set last_use_at = now() where user_id = #{userId} and portal_id = #{portalId}
    </update>

    <!--添加用户和站点的关系-->
    <insert id="addUserPortal">
        insert into user_portals (user_id, portal_id, last_use_at)
        values (#{userId}, #{portalId}, now())
    </insert>

    <!--通过站点id删除用户和站点的关系-->
    <delete id="deleteUserPortalsByPortalId">
        delete
        from user_portals
        where portal_id = #{id}
    </delete>
</mapper>